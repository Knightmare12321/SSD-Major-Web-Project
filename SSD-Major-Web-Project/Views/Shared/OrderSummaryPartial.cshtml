@model ICollection<SSD_Major_Web_Project.ViewModels.OrderVM>
<div class="table-responsive">
    <table class="table transaction-table">
        <thead>
            <tr>
                <th>Order Id</th>
                <th>Order Date</th>
                <th>Status</th>
                <th>Buyer Name</th>
                <th>Product</th>
                <th>Size</th>
                <th>Unit Price</th>
                <th>Qty</th>
                <th>Discount</th>
                <th>Order Total</th>
                <th></th>
                @{
                    if (ViewBag.SheetName == "open-orders")
                    {

                        <th></th>
                    }
                }
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                //first Line that lists eveything out
                <tr id="@ViewBag.SheetName-@item.OrderId-0">
                    <td> @Html.DisplayFor(modelItem => item.OrderId)</td>
                    <td> @Html.DisplayFor(modelItem => item.OrderDate)</td>
                    <td> @Html.DisplayFor(modelItem => item.OrderStatus)</td>
                    <td>@Html.DisplayName($"{item.Contact.FirstName} {item.Contact.LastName}")</td>
                    <td> @Html.DisplayFor(modelItem => item.OrderDetails[0].FkSku.FKproduct.Name)</td>
                    <td> @Html.DisplayFor(modelItem => item.OrderDetails[0].FkSku.Size)</td>
                    <td> @Html.DisplayFor(modelItem => item.OrderDetails[0].FkSku.FKproduct.Price)</td>
                    <td> @Html.DisplayFor(modelItem => item.OrderDetails[0].Quantity)</td>
                    <td> @Html.DisplayName($"{item.Discount?.PkDiscountCode}")</td>
                    <td> @Html.DisplayFor(modelItem => item.OrderTotal)</td>
                    <td><button class="btn">Detail</button></td>

                    @{
                        if (ViewBag.SheetName == "open-orders")
                        {

                            string rowGroupId = $"{@ViewBag.SheetName}-{@item.OrderId}";
                            <td><button class="btn" onclick="dispatchOrder(@item.OrderId,'@ViewBag.SheetName-@item.OrderId')">Dispatch</button></td>
                        }
                    }

                </tr>

                //subsequent lines only lists additional order items
                @for (var i = 1; i < item.OrderDetails.Count; i++)
                {
                    <tr id="@ViewBag.SheetName-@item.OrderId-@i">
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td> @Html.DisplayFor(modelItem => item.OrderDetails[i].FkSku.FKproduct.Name)</td>
                        <td> @Html.DisplayFor(modelItem => item.OrderDetails[i].FkSku.Size)</td>
                        <td> @Html.DisplayFor(modelItem => item.OrderDetails[i].FkSku.FKproduct.Price)</td>
                        <td> @Html.DisplayFor(modelItem => item.OrderDetails[i].Quantity)</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        @{
                            if (ViewBag.SheetName == "open-orders")
                            {

                                <td></td>
                            }
                        }
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

