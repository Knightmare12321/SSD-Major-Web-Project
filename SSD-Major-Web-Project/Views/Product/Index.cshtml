@model IEnumerable<SSD_Major_Web_Project.ViewModels.ProductVM>

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="product-page-wrapper">

    <div class="product-title"> MEN'S Clothes</div>

    <div class="search-bar">
        <div class="search-icon-wrapper">
            <img src="~/images/icon/icon-search.svg" class="search-icon"></img>
        </div>
        <div class="search-input-container">
            <div class="search-input-wrapper">
                <input type="text" placeholder="Search products" class="search-input"></input>
            </div>
        </div>
    </div>

    <div class="product-container">
                @foreach (var item in Model)
                {
                <div class="product-items-container">
                    <a asp-action="Details" asp-route-id="@item.PkProductId">
                        <div class="product-thumbnail-wrapper">
                            @if (item.ImageByteArray != null)
                            {
                            <img src="data:image/jpeg;base64,
                                    @Convert.ToBase64String(item.ImageByteArray)"
                                 alt="item.Name"
                                 class="product-thumbnail" />
                            }
                        </div>
                    </a>
                    <div class="product-info">
                        <div class="product-name"> @Html.DisplayFor(modelItem => item.Name) </div>
                        <div class="product-price"> @Html.DisplayFor(modelItem => item.Price) </div>
                    </div>
                </div>
                }
    </div>

    <button class="load-more">
        Load more products
    </button>

    @* <p>
        <a asp-action="Create">Create New</a>
    </p> *@
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>
        $(document).ready(function () {
            var page = 1; // Initial page number

            function loadMoreItems() {
                console.log("loading more items")
                $(".load-more").prop("disabled", true); // Disable the button
                $(".load-more").text("Loading..."); // Change button text to "Loading..."
                $.ajax({
                    url: '@Url.Action("LoadMoreItems", "Product")',
                    type: 'GET',
                    data: { page: page + 1 },
                    success: function (data) {
                        console.log("items quantity: " + data.length);
                        if (data.length > 0) {
                            $('.product-container').append(data);
                            page++; // Increment page number
                        } else {
                            console.log("hiding load-more button now");
                            $('.load-more').hide(); // Hide button if no more items
                        }
                    }, 
                    complete: function () {
                        $(".load-more").prop("disabled", false);
                        $(".load-more").text("Load more products");
                    }
                });
            }

            $(".load-more").click(function () {
                loadMoreItems();
            });
        })
    </script>

</div>